// constants
const TASK_BANKDATEN = "Geschäftskonto";
const TASK_DRUCKERZUWEISUNG = "Druckerzuweisung";
const TASK_KUNDE = "Kundengespräch";
const TASK_SKRIPTE = "Skripte";
const TASK_STEMPEL = "Stempel";
const TASK_EMAIL = "E-Mail";
const TASK_RECHTEVERWALTUNG = "Rechteverwaltung";
const TASK_ARZTBRIEF = "Arztbrief";
const TASK_BRIEFKOPF = "Briefkopf";
const TASK_PRIVATRECHNUNG = "Privatrechnung";
const TASK_RAEUME = "Räume";
const TASK_TODOS = "TODOs";
const TASK_LABOR = "Labor kontaktieren";
const TASK_ARBEITSPLATZGRUPPEN = "Arbeitsplatzgruppen";
const TASK_PRIVATREZEPT = "Privatrezept";
const TASK_UNTERSCHRIFT = "Unterschrift";
const TASK_EINSTELLUNGEN_ZOLLSOFT = "Zollsoft_Einstellungen";
const TASK_VSS = "VSS";
const TASK_AKTIONSKETTEN = "Aktionsketten";
const TASK_HAUSKATALOGE = "Hauskataloge";
const TASK_TEXTBAUSTEINE = "Textbausteine";
const TASK_GOAE_FAVORITEN = "GOÄ-Favoriten";
const TASK_FAX = "_Fax";
const TASK_PVS = "PVS";
const TASK_GERAETEVIDEOS = "Gerätevideos";
const TASK_FORMULARE = "Formulare";
const TASK_ZOLLSOFT = "Zollsoft kontaktieren";
const TASK_RESECO = "Reseco kontaktieren";
const TASK_KALENDER = "Kalender";
const TASK_TERMINERINNERUNG = "Terminerinnerung";
const TASK_OTK = "OTK";
const TASK_BSNR = "BSNR";
const TASK_BETRIEBSSTAETTEN = "Betriebsstätten";
const TASK_KASSENBUCH = "Kassenbuch";
const TASK_IMPFDOCNE = "ImpfDocNE";
const TASK_HZV = "HZV";
const TASK_LANR = "LANR";
const TASK_FACHRICHTUNG = "Fachrichtung(Betriebsstätten und Nutzer)";
const TASK_NUTZER = "Nutzer";
const TASK_SYMBOLLEISTE_IMPFDOC = "_Symbolleiste_ImpfDocNE_";
const TASK_BRIEFKOPF_HINTERGRUND = "_Briefkopf_Hintergrund_";
const TASK_OSX_DRUCKER = "_OSX_Drucker_";
const TASK_SPRACHERKENNUNG = "Spracherkennung";
const TASK_EMAIL_CLIENT = "_E-Mail_Client_";
const TASK_DRUCKEINSTELLUNGEN = "_Druckeinstellungen_";
const TASK_SYMBOLLEISTE_PRAXIS = "_Symbolleiste_Praxis_";
const TASK_AP_ERSTELLEN = "_AP_ertellen_";
const TASK_AP_SICHERN = "_AP_sichern_";
const TASK_DUPLEX = "_Duplex_";
const TASK_ARZEKO = "_Arzeko_";
const TASK_DOCTOLIB_CLIENT = "_DoctoLib_Client_";
const TASK_DOCTOLIB_TOMEDO = "_DoctoLib_Tomedo_";
const TASK_SCANNER = "_Scanner installieren (Software für \"Nicht-ScanSnap\": XSANE)_";
const TASK_UCC_CLIENT = "_UCC_Client_";
const TASK_UCC_ANMELDUNG = "_UCC_Anmeldung_";
const TASK_UCC_KOPPLUNG = "_UCC_Tomedo_Kopplung_";
const TASK_UCC_CALLMANAGER = "_UCC Callmanager anpassen_";
const TASK_IPAD = "_iPad_";
const TASK_TERMINALS = "_Kartenterminals_";
const TASK_IPAD_VPN = "_iPad_vpn_";
const TASK_FACHGRUPPEN = "Fachgruppen";
const TASK_BGRECHNUNG = "BG-Rechnung";
const TASK_KV_CONNECT = "KV-Connect";
const TASK_DMP = "DMP";
const TASK_HAUSDIAGNOSEN = "Hausdiagnosen";
const TASK_ANALOGZIFFERN = "Analogziffern";
const TASK_SACHKOSTEN = "Sachkosten";
const TASK_KARTEIEINTRAGSTYPEN = "Karteieintragstypen";
const TASK_EBM_FAVORITEN = "EBM-Favoriten";
const TASK_ICD_FAVORITEN = "ICD-Favoriten";
const TASK_SELBSTANMELDUNG = "Selbstanmeldung: Einstellungen > Arbeitsplatz > Kiosk";
const TASK_PRAXISNOTRUF = "Notruf";
const TASK_HITPANEL = "Hitpanel";
const TASK_SCHREIBER = "Herrn Schreiber kontaktieren (+49 5551- 908490)";
const TASK_TELEFONANBINDUNG = "Telefonanbindung";
const TASK_SMS = "SMS";
const TASK_BRIEFVORLAGEN = "Briefvorlagen";
const TASK_IPHONE = "iPhone";
const TASK_LABOR_DFUE = "Labor-DFÜ";
const TASK_LABOR_ZIFFERN = "Labor-Ziffern";
const TASK_LABORMASCHINEN = "Labormaschinen";
const TASK_UST_IDNR = "USt-idNr.";
const TASK_KIM = "KIM-Addresse";
const TASK_DALE_UV = "DALE-UV";
const TASK_HBA = "HBA";
const TASK_ARZT_DIREKT = "arzt-direkt";
const TASK_KV_BEREICH = "KV-Bereich";
const TASK_SYMBOLLEISTE = "_Symbolleiste (KBV, Attest, Schulbesch., Anwesenheit, Terminzettel)_";
const TASK_TI = "TI";
const TASK_MODULE_IMPFDOCNE = "ImpfDocNE-Modul aktivieren";
const TASK_IPHONE_VPN = "VPN Konfiguration erstellen";
const TASK_DOCTOLIB = "Doctolib kontaktieren";
const TASK_DOCTOLIB_KOPPLUNG = "Doctolib Kopplung";
const TASK_DATEIIMPORT = "Dateiimport";
const TASK_TODO_RAUM_ZUORDNUNG = "ToDo-Raum-Zuordnung";
const TASK_SCANNER_FARBIG = "farbigen Scan einstellen";
const TASK_FONTS = "_spezielle Fonts installieren";
const TASK_APPLE_ID = "Apple ID in Erfahrung bringen / erstellen";
const TASK_MOBIL = "Mobilnummer";
const TASK_GEB = "Geburtsdatum des Arztes (für Apple-ID)";
const TASK_FRUEHERKENNUNG = "Früherkennungsmodul";
const TASK_TESTS = "Abschließende Testung der Funktionalität";
const TASK_KAMERALOGIN = "Kameralogin";
const TASK_SCHULBESCHEINIGUNG = "Schulbescheinigung erstellen";
const TASK_TERMINZETTEL = "Terminzettel erstellen";
const TASK_ATTEST = "Attest erstellen";
const TASK_ANWESENHEIT = "Anwesenheitsbescheinigung erstellen";
const TASK_KBV = "KBV-Kopf konfigurieren";
const TASK_PAPIER = "Papier in die Drucker legen";
const TASK_BG = "BG Modul aktivieren";
const TASK_HKS = "eDoku Modul aktivieren";
const TASK_OPS = "OPS-Favoriten konfigurieren";

// listeners
document.getElementById("speichern").addEventListener("click", speichern, false);

// callbackfunctions
function notizen() {
    let notizen = new Map();

    if (document.getElementById('Betriebsstätten_Notiz').value != "")
        notizen.set('Betriebsstätten', document.getElementById('Betriebsstätten_Notiz').value);
    if (document.getElementById('TI_Notiz').value != "")
        notizen.set('TI', document.getElementById('TI_Notiz').value);
    if (document.getElementById('KIM_Notiz').value != "")
        notizen.set('KIM', document.getElementById('KIM_Notiz').value);
    if (document.getElementById('BG_Notiz').value != "")
        notizen.set('BG', document.getElementById('BG_Notiz').value);
    if (document.getElementById('DALE-UV_Notiz').value != "")
        notizen.set('DALE-UV', document.getElementById('DALE-UV_Notiz').value);
    if (document.getElementById('eHBA_Notiz').value != "")
        notizen.set('eHBA', document.getElementById('eHBA_Notiz').value);
    if (document.getElementById('HZV_Notiz').value != "")
        notizen.set('HZV', document.getElementById('HZV_Notiz').value);
    if (document.getElementById('Arbeitsplätze_Notiz').value != "")
        notizen.set('Arbeitsplätze', document.getElementById('Arbeitsplätze_Notiz').value);
    if (document.getElementById('Nutzer_Notiz').value != "")
        notizen.set('Nutzer', document.getElementById('Nutzer_Notiz').value);
    if (document.getElementById('KV-Connect_Notiz').value != "")
        notizen.set('KV-Connect', document.getElementById('KV-Connect_Notiz').value);
    if (document.getElementById('Todos_Notiz').value != "")
        notizen.set('Todos', document.getElementById('Todos_Notiz').value);
    if (document.getElementById('Kalender_Notiz').value != "")
        notizen.set('Kalender', document.getElementById('Kalender_Notiz').value);
    if (document.getElementById('OTK_Notiz').value != "")
        notizen.set('OTK', document.getElementById('OTK_Notiz').value);
    if (document.getElementById('Drucker_Notiz').value != "")
        notizen.set('Drucker', document.getElementById('Drucker_Notiz').value);
    if (document.getElementById('Arzeko_Notiz').value != "")
        notizen.set('Arzeko', document.getElementById('Arzeko_Notiz').value);
    if (document.getElementById('DMP_Notiz').value != "")
        notizen.set('DMP', document.getElementById('DMP_Notiz').value);
    if (document.getElementById('ImpfDocNE_Notiz').value != "")
        notizen.set('ImpfDocNE', document.getElementById('ImpfDocNE_Notiz').value);
    if (document.getElementById('Ust-Nr._Notiz').value != "")
        notizen.set('Ust-Nr.', document.getElementById('Ust-Nr._Notiz').value);
    if (document.getElementById('VSS_Notiz').value != "")
        notizen.set('VSS', document.getElementById('VSS_Notiz').value);
    if (document.getElementById('Aktionsketten_Notiz').value != "")
        notizen.set('Aktionsketten', document.getElementById('Aktionsketten_Notiz').value);
    if (document.getElementById('Sachkosten_Notiz').value != "")
        notizen.set('Sachkosten', document.getElementById('Sachkosten_Notiz').value);
    if (document.getElementById('Textbausteine_Notiz').value != "")
        notizen.set('Textbausteine', document.getElementById('Textbausteine_Notiz').value);
    if (document.getElementById('Karteieintragstypen_Notiz').value != "")
        notizen.set('Karteieintragstypen', document.getElementById('Karteieintragstypen_Notiz').value);
    if (document.getElementById('EBM-Favoriten_Notiz').value != "")
        notizen.set('EBM-Favoriten', document.getElementById('EBM-Favoriten_Notiz').value);
    if (document.getElementById('GOÄ-Favoriten_Notiz').value != "")
        notizen.set('GOÄ-Favoriten', document.getElementById('GOÄ-Favoriten_Notiz').value);
    if (document.getElementById('ICD-Favoriten_Notiz').value != "")
        notizen.set('ICD-Favoriten', document.getElementById('ICD-Favoriten_Notiz').value);
    if (document.getElementById('Selbstanmeldung_Notiz').value != "")
        notizen.set('Selbstanmeldung', document.getElementById('Selbstanmeldung_Notiz').value);
    if (document.getElementById('Rechte_Notiz').value != "")
        notizen.set('Rechte', document.getElementById('Rechte_Notiz').value);
    if (document.getElementById('Kassenbuch_Notiz').value != "")
        notizen.set('Kassenbuch', document.getElementById('Kassenbuch_Notiz').value);
    if (document.getElementById('Notruf_Notiz').value != "")
        notizen.set('Notruf', document.getElementById('Notruf_Notiz').value);
    if (document.getElementById('Hitpanel_Notiz').value != "")
        notizen.set('Hitpanel', document.getElementById('Hitpanel_Notiz').value);
    if (document.getElementById('Starface_Notiz').value != "")
        notizen.set('Starface', document.getElementById('Starface_Notiz').value);
    if (document.getElementById('E-Mail_Notiz').value != "")
        notizen.set('E-Mail', document.getElementById('E-Mail_Notiz').value);
    if (document.getElementById('Erinnerung_Notiz').value != "")
        notizen.set('Erinnerung', document.getElementById('Erinnerung_Notiz').value);
    if (document.getElementById('Hausdiagnosen_Notiz').value != "")
        notizen.set('Hausdiagnosen', document.getElementById('Hausdiagnosen_Notiz').value);
    if (document.getElementById('SMS_Notiz').value != "")
        notizen.set('SMS', document.getElementById('SMS_Notiz').value);
    if (document.getElementById('Fax_Notiz').value != "")
        notizen.set('Fax', document.getElementById('Fax_Notiz').value);
    if (document.getElementById('Privatrezept_Notiz').value != "")
        notizen.set('Privatrezept', document.getElementById('Privatrezept_Notiz').value);
    if (document.getElementById('Briefe_Notiz').value != "")
        notizen.set('Briefe', document.getElementById('Briefe_Notiz').value);
    if (document.getElementById('Formulare_Notiz').value != "")
        notizen.set('Formulare', document.getElementById('Formulare_Notiz').value);
    if (document.getElementById('iPads_Notiz').value != "")
        notizen.set('iPads', document.getElementById('iPads_Notiz').value);
    if (document.getElementById('iPhones_Notiz').value != "")
        notizen.set('iPhones', document.getElementById('iPhones_Notiz').value);
    if (document.getElementById('Labore_Notiz').value != "")
        notizen.set('Labore', document.getElementById('Labore_Notiz').value);
    if (document.getElementById('Labormaschinen_Notiz').value != "")
        notizen.set('Labormaschinen', document.getElementById('Labormaschinen_Notiz').value);
    if (document.getElementById('Doctolib_Notiz').value != "")
        notizen.set('Doctolib', document.getElementById('Doctolib_Notiz').value);
    if (document.getElementById('Räume_Notiz').value != "")
        notizen.set('Räume', document.getElementById('Räume_Notiz').value);
    if (document.getElementById('Spracherkennung_Notiz').value != "")
        notizen.set('Spracherkennung', document.getElementById('Spracherkennung_Notiz').value);
    if (document.getElementById('Scanner_Notiz').value != "")
        notizen.set('Scanner', document.getElementById('Scanner_Notiz').value);
    if (document.getElementById('Kameralogin_Notiz').value != "")
        notizen.set('Kameralogin', document.getElementById('Kameralogin_Notiz').value);
    if (document.getElementById('Früherkennung_Notiz').value != "")
        notizen.set('Früherkennung', document.getElementById('Früherkennung_Notiz').value);
    if (document.getElementById('eHKS/FEK/oKFE_Notiz').value != "")
        notizen.set('eHKS/FEK/oKFE', document.getElementById('eHKS/FEK/oKFE_Notiz').value);
    if (document.getElementById('Analogziffern_Notiz').value != "")
        notizen.set('Analogziffern', document.getElementById('Analogziffern_Notiz').value);
    if (document.getElementById('OPS-Favoriten_Notiz').value != "")
        notizen.set('OPS-Favoriten', document.getElementById('OPS-Favoriten_Notiz').value);

    return notizen;
}
function topsort() {
    let ts = Object.create(TopSort);

    if (document.getElementById('Betriebsstätten').checked && !document.getElementById('Betriebsstätten').disabled) {
        ts.add([TASK_KUNDE, TASK_BSNR]);
        ts.add([TASK_KUNDE, TASK_FACHGRUPPEN]);
        ts.add([TASK_KUNDE, TASK_BANKDATEN]);
        ts.add([TASK_BETRIEBSSTAETTEN, TASK_BSNR]);
    }
    if (document.getElementById('TI').checked && !document.getElementById('TI').disabled) {
        ts.add([TASK_ZOLLSOFT, TASK_TI]);
        ts.add([TASK_TI, TASK_TESTS]);
    }
    if (document.getElementById('KIM').checked && !document.getElementById('KIM').disabled) {
        ts.add([TASK_KUNDE, TASK_KIM]);
        ts.add([TASK_ZOLLSOFT, TASK_KIM]);
        ts.add([TASK_KIM, TASK_TESTS]);
    }
    if (document.getElementById('BG').checked && !document.getElementById('BG').disabled) {
        ts.add([TASK_BG]);
        ts.add([TASK_NUTZER, TASK_KAMERALOGIN]);
    }
    if (document.getElementById('DALE-UV').checked && !document.getElementById('DALE-UV').disabled) {
        ts.add([TASK_KUNDE, TASK_DALE_UV]);
        ts.add([TASK_DALE_UV, TASK_TESTS]);
    }
    if (document.getElementById('eHBA').checked && !document.getElementById('eHBA').disabled) {
        ts.add([TASK_KUNDE, TASK_HBA]);
        ts.add([TASK_HBA, TASK_TESTS]);
    }
    if (document.getElementById('HZV').checked && !document.getElementById('HZV').disabled) {
        ts.add([TASK_KUNDE, TASK_HZV]);
        ts.add([TASK_HZV, TASK_TESTS]);
    }
    if (document.getElementById('Arbeitsplätze').checked && !document.getElementById('Arbeitsplätze').disabled) {
        ts.add([TASK_KUNDE, TASK_AP_ERSTELLEN]);
        ts.add([TASK_BETRIEBSSTAETTEN, TASK_AP_ERSTELLEN]);
        ts.add([TASK_KV_BEREICH, TASK_AP_ERSTELLEN]);

        ts.add([TASK_AP_ERSTELLEN, TASK_AP_SICHERN]);
        ts.add([TASK_SYMBOLLEISTE, TASK_AP_SICHERN]);
        ts.add([TASK_SCHULBESCHEINIGUNG, TASK_SYMBOLLEISTE]);
        ts.add([TASK_ATTEST, TASK_SYMBOLLEISTE]);
        ts.add([TASK_ANWESENHEIT, TASK_SYMBOLLEISTE]);
        ts.add([TASK_TERMINZETTEL, TASK_SYMBOLLEISTE]);
        ts.add([TASK_KBV, TASK_SYMBOLLEISTE]);
        ts.add([TASK_DRUCKEINSTELLUNGEN, TASK_AP_SICHERN]);

        ts.add([TASK_BRIEFKOPF_HINTERGRUND, TASK_AP_SICHERN]);

        ts.add([TASK_AP_ERSTELLEN, TASK_ARBEITSPLATZGRUPPEN]);
        ts.add([TASK_TESTS, TASK_AP_SICHERN]);
    }
    if (document.getElementById('Nutzer').checked && !document.getElementById('Nutzer').disabled) {
        ts.add([TASK_KUNDE, TASK_NUTZER]);
        ts.add([TASK_KUNDE, TASK_LANR]);
        ts.add([TASK_KUNDE, TASK_STEMPEL]);
        ts.add([TASK_KUNDE, TASK_UNTERSCHRIFT]);
        ts.add([TASK_NUTZER, TASK_FACHGRUPPEN]);
    }
    if (document.getElementById('KV-Connect').checked && !document.getElementById('KV-Connect').disabled) {
        ts.add([TASK_KUNDE, TASK_KV_CONNECT]);
        ts.add([TASK_TI, TASK_KV_CONNECT]);
        ts.add([TASK_KV_CONNECT, TASK_TESTS]);
    }
    if (document.getElementById('Todos').checked && !document.getElementById('Todos').disabled) {
        ts.add([TASK_KUNDE, TASK_TODOS]);
        ts.add([TASK_TODOS, TASK_TODO_RAUM_ZUORDNUNG]);
        ts.add([TASK_RAEUME, TASK_TODO_RAUM_ZUORDNUNG]);
        ts.add([TASK_KUNDE, TASK_TODO_RAUM_ZUORDNUNG]);
    }
    if (document.getElementById('Kalender').checked && !document.getElementById('Kalender').disabled) {
        ts.add([TASK_KUNDE, TASK_KALENDER]);
        ts.add([TASK_KALENDER, TASK_TESTS]);
    }
    if (document.getElementById('OTK').checked && !document.getElementById('OTK').disabled) {
        ts.add([TASK_KUNDE, TASK_OTK]);
        ts.add([TASK_ZOLLSOFT, TASK_OTK]);
        ts.add([TASK_ARZT_DIREKT, TASK_OTK]);
        ts.add([TASK_ZOLLSOFT, TASK_ARZT_DIREKT]);
        ts.add([TASK_OTK, TASK_TESTS]);
    }
    if (document.getElementById('Drucker').checked && !document.getElementById('Drucker').disabled) {
        ts.add([TASK_DRUCKERZUWEISUNG]);
        ts.add([TASK_FORMULARE, TASK_DRUCKEINSTELLUNGEN]);
        ts.add([TASK_BRIEFVORLAGEN, TASK_DRUCKEINSTELLUNGEN]);
        ts.add([TASK_DRUCKEINSTELLUNGEN, TASK_TESTS]);
        ts.add([TASK_DRUCKERZUWEISUNG, TASK_PAPIER]);
    }
    if (document.getElementById('Arzeko').checked && !document.getElementById('Arzeko').disabled) {
        ts.add([TASK_ARZEKO]);
    }
    if (document.getElementById('DMP').checked && !document.getElementById('DMP').disabled) {
        ts.add([TASK_EINSTELLUNGEN_ZOLLSOFT, TASK_DMP]);
    }
    if (document.getElementById('ImpfDocNE').checked && !document.getElementById('ImpfDocNE').disabled) {
        ts.add([TASK_ZOLLSOFT, TASK_MODULE_IMPFDOCNE]);
        ts.add([TASK_MODULE_IMPFDOCNE, TASK_IMPFDOCNE]);
    }
    if (document.getElementById('Ust-Nr.').checked && !document.getElementById('Ust-Nr.').disabled) {
        ts.add([TASK_KUNDE, TASK_UST_IDNR]);
    }
    if (document.getElementById('VSS').checked && !document.getElementById('VSS').disabled) {
        ts.add([TASK_KUNDE, TASK_ARZT_DIREKT]);
        ts.add([TASK_ZOLLSOFT, TASK_ARZT_DIREKT]);
        ts.add([TASK_ARZT_DIREKT, TASK_VSS]);
        ts.add([TASK_VSS, TASK_TESTS]);
    }
    if (document.getElementById('Aktionsketten').checked && !document.getElementById('Aktionsketten').disabled) {
        ts.add([TASK_KUNDE, TASK_AKTIONSKETTEN]);
    }
    if (document.getElementById('Sachkosten').checked && !document.getElementById('Sachkosten').disabled) {
        ts.add([TASK_KUNDE, TASK_SACHKOSTEN]);
    }
    if (document.getElementById('Textbausteine').checked && !document.getElementById('Textbausteine').disabled) {
        ts.add([TASK_KUNDE, TASK_TEXTBAUSTEINE]);
    }
    if (document.getElementById('Karteieintragstypen').checked && !document.getElementById('Karteieintragstypen').disabled) {
        ts.add([TASK_KUNDE, TASK_KARTEIEINTRAGSTYPEN]);
        ts.add([TASK_ARZTBRIEF, TASK_KARTEIEINTRAGSTYPEN]);
        ts.add([TASK_BRIEFVORLAGEN, TASK_KARTEIEINTRAGSTYPEN]);
    }
    if (document.getElementById('EBM-Favoriten').checked && !document.getElementById('EBM-Favoriten').disabled) {
        ts.add([TASK_KUNDE, TASK_EBM_FAVORITEN]);
    }
    if (document.getElementById('GOÄ-Favoriten').checked && !document.getElementById('GOÄ-Favoriten').disabled) {
        ts.add([TASK_KUNDE, TASK_GOAE_FAVORITEN]);
    }
    if (document.getElementById('ICD-Favoriten').checked && !document.getElementById('ICD-Favoriten').disabled) {
        ts.add([TASK_KUNDE, TASK_ICD_FAVORITEN]);
    }
    if (document.getElementById('Selbstanmeldung').checked && !document.getElementById('Selbstanmeldung').disabled) {
        ts.add([TASK_NUTZER, TASK_SELBSTANMELDUNG]);
        ts.add([TASK_TODOS, TASK_SELBSTANMELDUNG]);
        ts.add([TASK_FORMULARE, TASK_SELBSTANMELDUNG]);
    }
    if (document.getElementById('Rechte').checked && !document.getElementById('Rechte').disabled) {
        ts.add([TASK_NUTZER, TASK_RECHTEVERWALTUNG]);
        ts.add([TASK_KUNDE, TASK_RECHTEVERWALTUNG]);
        ts.add([TASK_EMAIL, TASK_RECHTEVERWALTUNG]); // kein "must"
        ts.add([TASK_RECHTEVERWALTUNG, TASK_TESTS]);
    }
    if (document.getElementById('Kassenbuch').checked && !document.getElementById('Kassenbuch').disabled) {
        ts.add([TASK_KASSENBUCH]);
    }
    if (document.getElementById('Notruf').checked && !document.getElementById('Notruf').disabled) {
        ts.add([TASK_PRAXISNOTRUF]);
    }
    if (document.getElementById('Hitpanel').checked && !document.getElementById('Hitpanel').disabled) {
        ts.add([TASK_SCHREIBER, TASK_HITPANEL]);
        ts.add([TASK_KUNDE, TASK_HITPANEL]);
        ts.add([TASK_HITPANEL, TASK_TESTS]);
    }
    if (document.getElementById('Starface').checked && !document.getElementById('Starface').disabled) {
        ts.add([TASK_UCC_CLIENT, TASK_UCC_KOPPLUNG]);
        ts.add([TASK_UCC_ANMELDUNG, TASK_UCC_KOPPLUNG]);
        ts.add([TASK_UCC_CLIENT, TASK_UCC_ANMELDUNG]);
        ts.add([TASK_UCC_KOPPLUNG, TASK_AP_SICHERN]);
        ts.add([TASK_UCC_KOPPLUNG, TASK_TESTS]);
    }
    if (document.getElementById('E-Mail').checked && !document.getElementById('E-Mail').disabled) {
        ts.add([TASK_KUNDE, TASK_EMAIL]);
        ts.add([TASK_EMAIL, TASK_TESTS]);
    }
    if (document.getElementById('Erinnerung').checked && !document.getElementById('Erinnerung').disabled) {
        ts.add([TASK_KUNDE, TASK_TERMINERINNERUNG]);
        ts.add([TASK_EMAIL, TASK_TERMINERINNERUNG]);
        ts.add([TASK_TERMINERINNERUNG, TASK_TESTS]);
    }
    if (document.getElementById('Hausdiagnosen').checked && !document.getElementById('Hausdiagnosen').disabled) {
        ts.add([TASK_KUNDE, TASK_HAUSDIAGNOSEN]);
    }
    if (document.getElementById('SMS').checked && !document.getElementById('SMS').disabled) {
        ts.add([TASK_ZOLLSOFT, TASK_SMS]);
        ts.add([TASK_SMS, TASK_TESTS]);
    }
    if (document.getElementById('Fax').checked && !document.getElementById('Fax').disabled) {
        ts.add([TASK_UCC_ANMELDUNG, TASK_FAX]);
        ts.add([TASK_FAX, TASK_TESTS]);
        ts.add([TASK_KUNDE, TASK_FAX]);
    }
    if (document.getElementById('Privatrezept').checked && !document.getElementById('Privatrezept').disabled) {
        ts.add([TASK_KUNDE, TASK_PRIVATREZEPT]);
        ts.add([TASK_PVS]);
    }
    if (document.getElementById('Briefe').checked && !document.getElementById('Briefe').disabled) {
        ts.add([TASK_KUNDE, TASK_BRIEFVORLAGEN]);
        ts.add([TASK_BRIEFKOPF, TASK_BRIEFVORLAGEN]);
        ts.add([TASK_KUNDE, TASK_BRIEFKOPF]);
        ts.add([TASK_KUNDE, TASK_ARZTBRIEF]);
        ts.add([TASK_BRIEFVORLAGEN, TASK_BRIEFKOPF_HINTERGRUND]);
        ts.add([TASK_ARZTBRIEF, TASK_BRIEFKOPF_HINTERGRUND]);
        ts.add([TASK_BRIEFKOPF, TASK_BRIEFKOPF_HINTERGRUND]);
        ts.add([TASK_FONTS, TASK_BRIEFVORLAGEN]);
        ts.add([TASK_FONTS, TASK_BRIEFVORLAGEN]);
    }
    if (document.getElementById('Formulare').checked && !document.getElementById('Formulare').disabled) {
        ts.add([TASK_KUNDE, TASK_FORMULARE]);
        ts.add([TASK_FORMULARE, TASK_SYMBOLLEISTE]);
        ts.add([TASK_FONTS, TASK_FORMULARE]);
        ts.add([TASK_FONTS, TASK_FORMULARE]);
    }
    if (document.getElementById('iPads').checked && !document.getElementById('iPads').disabled) {
        ts.add([TASK_KUNDE, TASK_APPLE_ID]);
        ts.add([TASK_APPLE_ID, TASK_IPAD]);
        ts.add([TASK_IPAD_VPN, TASK_IPAD]);
        ts.add([TASK_MOBIL, TASK_APPLE_ID]);
        ts.add([TASK_GEB, TASK_APPLE_ID]);
    }
    if (document.getElementById('iPhones').checked && !document.getElementById('iPhones').disabled) {
        ts.add([TASK_IPHONE_VPN, TASK_IPHONE]);
    }
    if (document.getElementById('Labore').checked && !document.getElementById('Labore').disabled) {
        ts.add([TASK_LABOR, TASK_LABOR_DFUE]);
    }
    if (document.getElementById('Labormaschinen').checked && !document.getElementById('Labormaschinen').disabled) {
        ts.add([TASK_LABORMASCHINEN]);
    }
    if (document.getElementById('Doctolib').checked && !document.getElementById('Doctolib').disabled) {
        ts.add([TASK_EINSTELLUNGEN_ZOLLSOFT, TASK_DOCTOLIB_TOMEDO]);
        ts.add([TASK_DOCTOLIB, TASK_DOCTOLIB_KOPPLUNG]);
        ts.add([TASK_DOCTOLIB_CLIENT, TASK_DOCTOLIB_KOPPLUNG]);
    }
    if (document.getElementById('Räume').checked && !document.getElementById('Räume').disabled) {
        ts.add([TASK_RAEUME]);
    }
    if (document.getElementById('Spracherkennung').checked && !document.getElementById('Spracherkennung').disabled) {
        ts.add([TASK_ZOLLSOFT, TASK_SPRACHERKENNUNG]);
    }
    if (document.getElementById('Scanner').checked && !document.getElementById('Scanner').disabled) {
        ts.add([TASK_SCANNER, TASK_SCANNER_FARBIG]);
        ts.add([TASK_DATEIIMPORT]);
    }
    if (document.getElementById('Kameralogin').checked && !document.getElementById('Kameralogin').disabled) {
        ts.add([TASK_NUTZER, TASK_KAMERALOGIN]);
    }
    if (document.getElementById('Früherkennung').checked && !document.getElementById('Früherkennung').disabled) {
        ts.add([TASK_KUNDE, TASK_FRUEHERKENNUNG]);
    }
    if (document.getElementById('eHKS/FEK/oKFE').checked && !document.getElementById('eHKS/FEK/oKFE').disabled) {
        ts.add([TASK_HKS]);
    }
    if (document.getElementById('Analogziffern').checked && !document.getElementById('Analogziffern').disabled) {
        ts.add([TASK_KUNDE, TASK_ANALOGZIFFERN]);
    }
    if (document.getElementById('OPS-Favoriten').checked && !document.getElementById('OPS-Favoriten').disabled) {
        ts.add([TASK_KUNDE, TASK_OPS]);
    }

    return ts;
}
function speichern() {
    let todo_list = "";
    let kunde_list = "";
    let zollsoft_list = "";
    let labor_list = "";
    let schreiber_list = "";
    let docto_list = "";
    let notizen_list = "";
    let list = "";

    for (const task of topsort().topsort()) {
        todo_list += `- [ ] ${task}\n`;
    }
    for (const task of topsort().succ(TASK_KUNDE)) {
        kunde_list += `- [ ] ${task}\n`;
    }
    for (const task of topsort().succ(TASK_ZOLLSOFT)) {
        zollsoft_list += `- [ ] ${task}\n`;
    }
    for (const task of topsort().succ(TASK_LABOR)) {
        labor_list += `- [ ] ${task}\n`;
    }
    for (const task of topsort().succ(TASK_SCHREIBER)) {
        schreiber_list += `- [ ] ${task}\n`;
    }
    for (const task of topsort().succ(TASK_DOCTOLIB)) {
        docto_list += `- [ ] ${task}\n`;
    }
    for (const [key, value] of notizen().entries()) {
        notizen_list += `* ${key}: ${value}\n`;
    }

    if (todo_list != "")
        list += `## TODO:\n${todo_list}\n`;
    if (kunde_list != "")
        list += `## Kundengespräch:\n${kunde_list}\n`;
    if (zollsoft_list != "")
        list += `## Zollsoft kontaktieren:\n${zollsoft_list}\n`;
    if (labor_list != "")
        list += `## Labor kontaktieren:\n${labor_list}\n`;
    if (schreiber_list != "")
        list += `## Hr. Schreiber kontaktieren:\n${schreiber_list}\n`;
    if (docto_list != "")
        list += `## Doctolib kontaktieren:\n${docto_list}\n`;
    if (notizen_list != "")
        list += `## Notizen:\n${notizen_list}\n`;

    download(`${document.getElementById('filename').value}.md`, list);
}
function download(filename, text) {
    const fileBlob = new Blob([text], { type: 'application/octet-binary' })
    const url = URL.createObjectURL(fileBlob)

    const link = document.createElement('a')
    link.setAttribute('href', url)
    link.setAttribute('download', filename)

    if (document.createEvent) {
        const event = document.createEvent('MouseEvents')
        event.initEvent('click', true, true)
        link.dispatchEvent(event)
    } else {
        link.click()
    }

    // Deallocate resources
    if (URL.revokeObjectURL)
        URL.revokeObjectURL(url)
}

// logic
const TopSort = {
    regeln: [],
    add: function (dep) {
        this.regeln.push(dep);
    },
    // returns a list of all tasks. Each task occurs just ones.
    tasks: function () {
        var res = [];
        for (var i = 0; i < this.regeln.length; ++i) {
            if (!res.includes(this.regeln[i][0])) {
                res.push(this.regeln[i][0]);
            }
            if (!res.includes(this.regeln[i][1]) && typeof (this.regeln[i][1]) !== "undefined") {
                res.push(this.regeln[i][1]);
            }
        }
        return res;
    },
    topsort: function () {
        var res = [];
        var tasks = this.tasks();
        var i = 0;
        while (tasks.length > 0) {
            var dep = this.dep(tasks[i]);
            if (dep.every(val => res.includes(val))) {
                res.push(tasks[i]);
                tasks.splice(i, 1);
                i = 0;
            }
            else {
                ++i;
            }
        }
        return res;
    },
    // returns all dependencies of one task
    dep: function (task) {
        let res = [];
        for (var i = 0; i < this.regeln.length; ++i) {
            if (this.regeln[i][1] === task) {
                res.push(this.regeln[i][0]);
            }
        }
        return res;
    },
    // returns a list of all successors of a task
    succ: function (task) {
        let res = new Set();
        for (var i = 0; i < this.regeln.length; ++i) {
            if (this.regeln[i][0] === task) {
                res.add(this.regeln[i][1]);
            }
        }
        return res;
    },
    clear: function () {
        this.regeln = [];
    }
}